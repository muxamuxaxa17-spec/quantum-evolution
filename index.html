<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quantum Evolution</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* –ë–∞–∑–æ–≤—ã–µ —Å–±—Ä–æ—Å—ã */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0F0F23, #1A1A2E);
            color: white;
            line-height: 1.4;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä */
        .mobile-container {
            max-width: 100%;
            min-height: 100vh;
            padding: 20px 16px 80px;
        }

        /* –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å */
        .stats-bar {
            display: flex;
            justify-content: space-around;
            background: rgba(255, 255, 255, 0.1);
            padding: 12px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 1px solid rgba(139, 0, 255, 0.3);
        }

        .resource {
            display: flex;
            align-items: center;
            gap: 6px;
            font-weight: bold;
        }

        /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç */
        .progress-section {
            text-align: center;
            padding: 30px 0;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(139, 0, 255, 0.2);
        }

        .size-display {
            font-size: 2rem;
            font-weight: bold;
            color: #8B00FF;
            margin-bottom: 8px;
            text-shadow: 0 0 10px rgba(139, 0, 255, 0.5);
        }

        .stage-display {
            font-size: 1.2rem;
            margin-bottom: 4px;
        }

        .era-display {
            font-size: 0.9rem;
            color: #B0B0B0;
            margin-bottom: 16px;
        }

        .progress-bar {
            width: 80%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            margin: 0 auto;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #8B00FF, #00BFFF);
            border-radius: 4px;
            transition: width 0.3s ease;
            width: 0%;
        }

        /* –û—Å–Ω–æ–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞ */
        .action-section {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }

        .main-action-btn {
            width: 180px;
            height: 180px;
            border-radius: 50%;
            background: linear-gradient(135deg, #8B00FF, #00BFFF);
            border: none;
            color: white;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 8px 32px rgba(139, 0, 255, 0.4);
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .main-action-btn:active {
            transform: scale(0.95);
            box-shadow: 0 4px 16px rgba(139, 0, 255, 0.6);
        }

        /* –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è */
        .quick-actions {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        .quick-btn {
            padding: 15px 8px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            color: white;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .quick-btn:active {
            background: rgba(139, 0, 255, 0.3);
            transform: scale(0.98);
        }

        /* –ù–∏–∂–Ω—è—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(26, 26, 46, 0.95);
            backdrop-filter: blur(10px);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            padding: 12px 16px;
            gap: 8px;
        }

        .nav-btn {
            flex: 1;
            padding: 12px;
            background: transparent;
            border: none;
            border-radius: 12px;
            color: #B0B0B0;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .nav-btn.active {
            background: rgba(139, 0, 255, 0.2);
            color: #8B00FF;
        }

        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .stage-notification {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }

        .notification-content {
            background: linear-gradient(135deg, #1A1A2E, #0F0F23);
            padding: 24px;
            border-radius: 20px;
            border: 2px solid #8B00FF;
            text-align: center;
            max-width: 300px;
            width: 100%;
        }

        .notification-content h3 {
            color: #8B00FF;
            margin-bottom: 12px;
        }

        .notification-content p {
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .notification-close {
            background: linear-gradient(135deg, #8B00FF, #00BFFF);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
        }

        /* Telegram –∫–Ω–æ–ø–∫–∞ */
        .tg-button {
            background: #0088cc;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 12px;
            margin: 10px 0;
            cursor: pointer;
            width: 100%;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="mobile-container">
        <!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å —Ä–µ—Å—É—Ä—Å–æ–≤ -->
        <div class="stats-bar">
            <div class="resource">‚ö° <span id="energy">1,250</span></div>
            <div class="resource">üß† <span id="knowledge">450</span></div>
            <div class="resource">üíé <span id="fragments">0</span></div>
        </div>

        <!-- –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ Telegram -->
        <div id="tg-welcome" style="display: none; text-align: center; margin-bottom: 20px;">
            <h3 id="tg-username">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Quantum Evolution!</h3>
        </div>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å -->
        <div class="progress-section">
            <div class="size-display" id="current-size">1.6e-35 –º</div>
            <div class="stage-display" id="current-stage">–ü–ª–∞–Ω–∫–æ–≤—Å–∫–∞—è –¥–ª–∏–Ω–∞</div>
            <div class="era-display" id="current-era">–ö–≤–∞–Ω—Ç–æ–≤–∞—è —ç—Ä–∞</div>
            
            <div class="progress-bar">
                <div class="progress-fill" id="stage-progress"></div>
            </div>
        </div>

        <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è -->
        <div class="action-section">
            <button class="main-action-btn" id="quantum-fluctuation">
                ‚öõÔ∏è<br>–ö–≤–∞–Ω—Ç–æ–≤–∞—è<br>—Ñ–ª—É–∫—Ç—É–∞—Ü–∏—è
            </button>
        </div>

        <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
        <div class="quick-actions">
            <button class="quick-btn" id="auto-growth">ü§ñ<br>–ê–≤—Ç–æ-—Ä–æ—Å—Ç</button>
            <button class="quick-btn" id="research-btn">üî¨<br>–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è</button>
            <button class="quick-btn" id="prestige-btn">üí•<br>–ë–æ–ª—å—à–æ–π –≤–∑—Ä—ã–≤</button>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è Telegram -->
        <button class="tg-button" id="tg-share" style="display: none;">
            üì§ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º
        </button>
    </div>

    <!-- –ù–∏–∂–Ω—è—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è -->
    <nav class="bottom-nav">
        <button class="nav-btn active" data-tab="main">üåå</button>
        <button class="nav-btn" data-tab="research">üî¨</button>
        <button class="nav-btn" data-tab="progress">üìä</button>
        <button class="nav-btn" data-tab="library">üìö</button>
    </nav>

    <script>
        // === TELEGRAM INIT ===
        let tg = window.Telegram?.WebApp;
        
        if (tg) {
            tg.expand(); // –†–∞—Å–∫—Ä—ã–≤–∞–µ–º –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω
            tg.enableClosingConfirmation(); // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–∏—è
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
            const user = tg.initDataUnsafe?.user;
            if (user) {
                document.getElementById('tg-welcome').style.display = 'block';
                document.getElementById('tg-username').textContent = `üëã –ü—Ä–∏–≤–µ—Ç, ${user.first_name}!`;
                document.getElementById('tg-share').style.display = 'block';
            }
        }

        // === –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ò–ì–†–´ ===
        const stages = [
            // –ö–≤–∞–Ω—Ç–æ–≤–∞—è —ç—Ä–∞
            { 
                name: "–ü–ª–∞–Ω–∫–æ–≤—Å–∫–∞—è –¥–ª–∏–Ω–∞", 
                size: 1.6e-35, 
                era: "quantum", 
                fact: "–ù–∞–∏–º–µ–Ω—å—à–∞—è –≤–æ–∑–º–æ–∂–Ω–∞—è –¥–ª–∏–Ω–∞ –≤ —Ñ–∏–∑–∏–∫–µ - 1.6 √ó 10‚Åª¬≥‚Åµ –º–µ—Ç—Ä–æ–≤" 
            },
            { 
                name: "–ö–≤–∞–Ω—Ç–æ–≤—ã–µ —Å—Ç—Ä—É–Ω—ã", 
                size: 1e-33, 
                era: "quantum", 
                fact: "–ì–∏–ø–æ—Ç–µ—Ç–∏—á–µ—Å–∫–∏–µ –æ–¥–Ω–æ–º–µ—Ä–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã –≤ —Ç–µ–æ—Ä–∏–∏ —Å—Ç—Ä—É–Ω" 
            },
            { 
                name: "–í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ —á–∞—Å—Ç–∏—Ü—ã", 
                size: 1e-31, 
                era: "quantum", 
                fact: "–ß–∞—Å—Ç–∏—Ü—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –ø–æ—è–≤–ª—è—é—Ç—Å—è –∏ –∏—Å—á–µ–∑–∞—é—Ç –≤ –∫–≤–∞–Ω—Ç–æ–≤–æ–π –ø–µ–Ω–µ" 
            },
            { 
                name: "–ö–≤–∞—Ä–∫", 
                size: 1e-18, 
                era: "quantum", 
                fact: "–§—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ —á–∞—Å—Ç–∏—Ü—ã, –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö —Å–æ—Å—Ç–æ—è—Ç –ø—Ä–æ—Ç–æ–Ω—ã –∏ –Ω–µ–π—Ç—Ä–æ–Ω—ã" 
            },
            
            // –ê—Ç–æ–º–Ω–∞—è —ç—Ä–∞
            { 
                name: "–ê—Ç–æ–º –≤–æ–¥–æ—Ä–æ–¥–∞", 
                size: 1e-10, 
                era: "atomic", 
                fact: "–°–∞–º—ã–π —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –≤–æ –í—Å–µ–ª–µ–Ω–Ω–æ–π - 75% –±–∞—Ä–∏–æ–Ω–Ω–æ–π –º–∞—Å—Å—ã" 
            },
            { 
                name: "–ê—Ç–æ–º —É–≥–ª–µ—Ä–æ–¥–∞", 
                size: 1.5e-10, 
                era: "atomic", 
                fact: "–û—Å–Ω–æ–≤–∞ –≤—Å–µ–π –æ—Ä–≥–∞–Ω–∏—á–µ—Å–∫–æ–π —Ö–∏–º–∏–∏ –∏ –∂–∏–∑–Ω–∏ –Ω–∞ –ó–µ–º–ª–µ" 
            },
            
            // –ë–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è —ç—Ä–∞
            { 
                name: "–í–∏—Ä—É—Å", 
                size: 1e-7, 
                era: "biological", 
                fact: "–ù–µ —Å—á–∏—Ç–∞–µ—Ç—Å—è –∂–∏–≤—ã–º –æ—Ä–≥–∞–Ω–∏–∑–º–æ–º, –Ω–æ –º–æ–∂–µ—Ç —Ä–∞–∑–º–Ω–æ–∂–∞—Ç—å—Å—è –≤ –∫–ª–µ—Ç–∫–∞—Ö" 
            },
            { 
                name: "–ë–∞–∫—Ç–µ—Ä–∏—è", 
                size: 1e-6, 
                era: "biological", 
                fact: "–ü–µ—Ä–≤—ã–µ –∂–∏–≤—ã–µ –æ—Ä–≥–∞–Ω–∏–∑–º—ã –Ω–∞ –ó–µ–º–ª–µ, –ø–æ—è–≤–∏–ª–∏—Å—å 3.5 –º–ª—Ä–¥ –ª–µ—Ç –Ω–∞–∑–∞–¥" 
            },
            { 
                name: "–ö–ª–µ—Ç–∫–∞ —á–µ–ª–æ–≤–µ–∫–∞", 
                size: 1e-5, 
                era: "biological", 
                fact: "–°—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–π –∫–ª–µ—Ç–∫–∏ - 10 –º–∏–∫—Ä–æ–º–µ—Ç—Ä–æ–≤" 
            },
            
            // –ú–∞–∫—Ä–æ —ç—Ä–∞
            { 
                name: "–ß–µ–ª–æ–≤–µ–∫", 
                size: 1.7, 
                era: "macro", 
                fact: "Homo sapiens - –≤–∏–¥ —Å —Å–∞–º—ã–º —Ä–∞–∑–≤–∏—Ç—ã–º –º–æ–∑–≥–æ–º –Ω–∞ –ó–µ–º–ª–µ" 
            },
            { 
                name: "–ì–æ–ª—É–±–æ–π –∫–∏—Ç", 
                size: 30, 
                era: "macro", 
                fact: "–°–∞–º–æ–µ –±–æ–ª—å—à–æ–µ –∂–∏–≤–æ—Ç–Ω–æ–µ –≤ –∏—Å—Ç–æ—Ä–∏–∏ –ó–µ–º–ª–∏" 
            },
            
            // –ö–æ—Å–º–∏—á–µ—Å–∫–∞—è —ç—Ä–∞
            { 
                name: "–≠–≤–µ—Ä–µ—Å—Ç", 
                size: 8848, 
                era: "cosmic", 
                fact: "–°–∞–º–∞—è –≤—ã—Å–æ–∫–∞—è –≥–æ—Ä–∞ –Ω–∞ –ó–µ–º–ª–µ - 8848 –º–µ—Ç—Ä–æ–≤" 
            },
            { 
                name: "–ó–µ–º–ª—è", 
                size: 1.27e7, 
                era: "cosmic", 
                fact: "–î–∏–∞–º–µ—Ç—Ä –ó–µ–º–ª–∏ - 12,742 –∫–º, —Ç—Ä–µ—Ç—å—è –ø–ª–∞–Ω–µ—Ç–∞ –æ—Ç –°–æ–ª–Ω—Ü–∞" 
            },
            { 
                name: "–°–æ–ª–Ω—Ü–µ", 
                size: 1.39e9, 
                era: "cosmic", 
                fact: "–ó–≤–µ–∑–¥–∞, —Å–æ–¥–µ—Ä–∂–∞—â–∞—è 99.86% –º–∞—Å—Å—ã –°–æ–ª–Ω–µ—á–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã" 
            },
        ];

        const eras = {
            quantum: { name: "–ö–≤–∞–Ω—Ç–æ–≤–∞—è —ç—Ä–∞", color: "#8B00FF" },
            atomic: { name: "–ê—Ç–æ–º–Ω–∞—è —ç—Ä–∞", color: "#00BFFF" },
            biological: { name: "–ë–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è —ç—Ä–∞", color: "#32CD32" },
            macro: { name: "–ú–∞–∫—Ä–æ —ç—Ä–∞", color: "#FFD700" },
            cosmic: { name: "–ö–æ—Å–º–∏—á–µ—Å–∫–∞—è —ç—Ä–∞", color: "#FF4500" }
        };

        // === –°–û–°–¢–û–Ø–ù–ò–ï –ò–ì–†–´ ===
        let gameState = {
            size: 1.6e-35,
            currentStage: 0,
            energy: 1250,
            knowledge: 450,
            quantumFragments: 0,
            autoGrowth: 0,
            growthMultiplier: 1,
            totalClicks: 0,
            totalBigBangs: 0
        };

        // === –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò ===
        function initGame() {
            console.log("üöÄ –ò–≥—Ä–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è...");
            loadGame();
            setupEventListeners();
            startGameLoop();
            updateDisplay();
            console.log("‚úÖ –ò–≥—Ä–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω–∞!");
        }

        function loadGame() {
            try {
                // –ü—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ Telegram Cloud Storage
                if (tg) {
                    tg.CloudStorage.getItem('quantum_evolution', (err, data) => {
                        if (!err && data) {
                            const loaded = JSON.parse(data);
                            Object.assign(gameState, loaded);
                            console.log("üíæ –ò–≥—Ä–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∏–∑ Telegram Cloud");
                        } else {
                            // –ï—Å–ª–∏ –Ω–µ—Ç –≤ –æ–±–ª–∞–∫–µ, –ø—Ä–æ–±—É–µ–º localStorage
                            loadFromLocalStorage();
                        }
                    });
                } else {
                    loadFromLocalStorage();
                }
            } catch (e) {
                console.log("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:", e);
            }
        }

        function loadFromLocalStorage() {
            const saved = localStorage.getItem('quantumEvolution');
            if (saved) {
                const loaded = JSON.parse(saved);
                Object.assign(gameState, loaded);
                console.log("üíæ –ò–≥—Ä–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∏–∑ localStorage");
            }
        }

        function saveGame() {
            try {
                const saveData = JSON.stringify(gameState);
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Telegram Cloud Storage
                if (tg) {
                    tg.CloudStorage.setItem('quantum_evolution', saveData, (err) => {
                        if (err) {
                            console.log("‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ Telegram Cloud:", err);
                            localStorage.setItem('quantumEvolution', saveData);
                        } else {
                            console.log("üíæ –ò–≥—Ä–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ Telegram Cloud");
                        }
                    });
                } else {
                    localStorage.setItem('quantumEvolution', saveData);
                }
            } catch (e) {
                console.log("‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:", e);
            }
        }

        function setupEventListeners() {
            // –û—Å–Ω–æ–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞
            const mainBtn = document.getElementById('quantum-fluctuation');
            mainBtn.addEventListener('click', handleQuantumFluctuation);
            mainBtn.addEventListener('touchstart', function(e) {
                e.preventDefault();
                handleQuantumFluctuation();
            });

            // –ë—ã—Å—Ç—Ä—ã–µ –∫–Ω–æ–ø–∫–∏
            document.getElementById('auto-growth').addEventListener('click', function() {
                showMessage("ü§ñ –ê–≤—Ç–æ-—Ä–æ—Å—Ç", "–°–∫–æ—Ä–æ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ!");
            });
            
            document.getElementById('research-btn').addEventListener('click', function() {
                showMessage("üî¨ –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è", "–°–∫–æ—Ä–æ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ!");
            });
            
            document.getElementById('prestige-btn').addEventListener('click', function() {
                showMessage("üí• –ë–æ–ª—å—à–æ–π –≤–∑—Ä—ã–≤", "–°–∫–æ—Ä–æ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ!");
            });

            // –ö–Ω–æ–ø–∫–∞ –ø–æ–¥–µ–ª–∏—Ç—å—Å—è –≤ Telegram
            document.getElementById('tg-share').addEventListener('click', shareProgress);

            // –ù–∞–≤–∏–≥–∞—Ü–∏—è
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const tab = this.dataset.tab;
                    switchTab(tab);
                });
            });
        }

        function shareProgress() {
            const currentStage = stages[gameState.currentStage];
            const message = `üåå Quantum Evolution\nüìè –ú–æ–π —Ä–∞–∑–º–µ—Ä: ${formatSize(gameState.size)}\nüéØ –≠—Ç–∞–ø: ${currentStage.name}\n‚ö° –≠–Ω–µ—Ä–≥–∏—è: ${Math.floor(gameState.energy)}\n\n–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Å—è –∫ —ç–≤–æ–ª—é—Ü–∏–∏!`;
            
            if (tg) {
                tg.shareMessage(message);
            } else {
                // –î–ª—è –±—Ä–∞—É–∑–µ—Ä–∞
                if (navigator.share) {
                    navigator.share({
                        title: 'Quantum Evolution',
                        text: message,
                        url: window.location.href
                    });
                } else {
                    navigator.clipboard.writeText(message).then(() => {
                        showMessage("üìã", "–ü—Ä–æ–≥—Ä–µ—Å—Å —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!");
                    });
                }
            }
        }

        function startGameLoop() {
            setInterval(() => {
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–æ—Å—Ç (–µ—Å–ª–∏ –µ—Å—Ç—å)
                if (gameState.autoGrowth > 0) {
                    gameState.size += gameState.autoGrowth * gameState.growthMultiplier;
                    checkStageProgression();
                    updateDisplay();
                }
            }, 1000);

            // –ê–≤—Ç–æ-—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
            setInterval(saveGame, 30000);
        }

        function handleQuantumFluctuation() {
            const baseGrowth = 1.6e-37;
            gameState.size += baseGrowth * gameState.growthMultiplier;
            gameState.energy += 1;
            gameState.knowledge += 0.5;
            gameState.totalClicks++;
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –∫–Ω–æ–ø–∫–∏
            const btn = document.getElementById('quantum-fluctuation');
            btn.style.transform = 'scale(0.95)';
            setTimeout(() => btn.style.transform = 'scale(1)', 100);
            
            checkStageProgression();
            updateDisplay();
            
            console.log("‚öõÔ∏è –ö–≤–∞–Ω—Ç–æ–≤–∞—è —Ñ–ª—É–∫—Ç—É–∞—Ü–∏—è! –†–∞–∑–º–µ—Ä:", gameState.size);
        }

        function checkStageProgression() {
            const currentStageIndex = gameState.currentStage;
            const currentStage = stages[currentStageIndex];
            const nextStage = stages[currentStageIndex + 1];
            
            if (nextStage && gameState.size >= nextStage.size) {
                gameState.currentStage++;
                showStageNotification(stages[gameState.currentStage]);
            }
        }

        function showStageNotification(stage) {
            const notification = document.createElement('div');
            notification.className = 'stage-notification';
            notification.innerHTML = `
                <div class="notification-content">
                    <h3>üéâ ${stage.name}</h3>
                    <p>${stage.fact}</p>
                    <button class="notification-close">‚ú® –ü–æ–Ω—è—Ç–Ω–æ</button>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            notification.querySelector('.notification-close').addEventListener('click', function() {
                document.body.removeChild(notification);
            });
        }

        function showMessage(title, text) {
            const notification = document.createElement('div');
            notification.className = 'stage-notification';
            notification.innerHTML = `
                <div class="notification-content">
                    <h3>${title}</h3>
                    <p>${text}</p>
                    <button class="notification-close">OK</button>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            notification.querySelector('.notification-close').addEventListener('click', function() {
                document.body.removeChild(notification);
            });
        }

        function updateDisplay() {
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–∞–∑–º–µ—Ä
            document.getElementById('current-size').textContent = formatSize(gameState.size);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —ç—Ç–∞–ø –∏ —ç—Ä—É
            const currentStage = stages[gameState.currentStage];
            document.getElementById('current-stage').textContent = currentStage.name;
            document.getElementById('current-era').textContent = eras[currentStage.era].name;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ—Å—É—Ä—Å—ã
            document.getElementById('energy').textContent = Math.floor(gameState.energy);
            document.getElementById('knowledge').textContent = Math.floor(gameState.knowledge);
            document.getElementById('fragments').textContent = gameState.quantumFragments;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
            updateProgressBar();
        }

        function formatSize(size) {
            if (size < 1e-9) {
                return size.toExponential(2) + ' –º';
            } else if (size < 1e-6) {
                return (size * 1e9).toFixed(2) + ' –Ω–º';
            } else if (size < 1e-3) {
                return (size * 1e6).toFixed(2) + ' –º–∫–º';
            } else if (size < 1) {
                return (size * 1000).toFixed(2) + ' –º–º';
            } else if (size < 1000) {
                return size.toFixed(2) + ' –º';
            } else {
                return (size / 1000).toFixed(2) + ' –∫–º';
            }
        }

        function updateProgressBar() {
            const currentStage = stages[gameState.currentStage];
            const nextStage = stages[gameState.currentStage + 1];
            
            if (!nextStage) {
                document.getElementById('stage-progress').style.width = '100%';
                return;
            }
            
            const progress = (gameState.size - currentStage.size) / (nextStage.size - currentStage.size);
            const progressPercent = Math.min(100, Math.max(0, progress * 100));
            
            document.getElementById('stage-progress').style.width = progressPercent + '%';
        }

        function switchTab(tabName) {
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –¥—Ä—É–≥–∏—Ö –≤–∫–ª–∞–¥–æ–∫
            if (tabName !== 'main') {
                showMessage(
                    "üîß –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ", 
                    "–≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è —Å–∫–æ—Ä–æ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞! –°–µ–π—á–∞—Å —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á—å—Ç–µ—Å—å –Ω–∞ –∫–≤–∞–Ω—Ç–æ–≤—ã—Ö —Ñ–ª—É–∫—Ç—É–∞—Ü–∏—è—Ö."
                );
            }
        }

        // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä—É –∫–æ–≥–¥–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è
        document.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>
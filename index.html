<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quantum Evolution</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --primary: #8B00FF;
            --secondary: #00BFFF;
            --accent: #FF00FF;
            --background: #0F0F23;
            --surface: #1A1A2E;
            --text: #FFFFFF;
            --text-secondary: #B0B0B0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, var(--background), #2D2D4D);
            color: var(--text);
            min-height: 100vh;
            line-height: 1.6;
        }

        .game-container {
            max-width: 100%;
            min-height: 100vh;
            padding: 20px 16px 80px;
        }

        /* –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å */
        .game-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .game-title {
            font-size: 2rem;
            font-weight: bold;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            color: transparent;
            margin-bottom: 8px;
        }

        .user-welcome {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* –†–µ—Å—É—Ä—Å—ã */
        .resources-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin-bottom: 25px;
        }

        .resource-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(139, 0, 255, 0.3);
            border-radius: 12px;
            padding: 15px 10px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .resource-card:hover {
            transform: translateY(-2px);
            border-color: var(--primary);
            box-shadow: 0 4px 12px rgba(139, 0, 255, 0.2);
        }

        .resource-icon {
            font-size: 1.5em;
            margin-bottom: 5px;
        }

        .resource-name {
            font-size: 0.8em;
            opacity: 0.8;
            margin-bottom: 4px;
        }

        .resource-value {
            font-size: 1.1em;
            font-weight: bold;
            color: var(--primary);
        }

        /* –û—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å */
        .progress-section {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(139, 0, 255, 0.2);
            border-radius: 20px;
            padding: 25px 20px;
            margin-bottom: 25px;
            text-align: center;
        }

        .size-display {
            font-size: 2.2rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 8px;
            text-shadow: 0 0 15px rgba(139, 0, 255, 0.5);
        }

        .stage-display {
            font-size: 1.3rem;
            margin-bottom: 5px;
        }

        .era-display {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        .progress-container {
            width: 100%;
            height: 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 6px;
            transition: width 0.5s ease;
            width: 0%;
        }

        /* –û—Å–Ω–æ–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞ */
        .action-section {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }

        .main-action-btn {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: none;
            color: white;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 8px 32px rgba(139, 0, 255, 0.4);
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .main-action-btn::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: rotate(45deg);
            transition: all 0.6s ease;
        }

        .main-action-btn:hover::before {
            transform: rotate(45deg) translate(50%, 50%);
        }

        .main-action-btn:active {
            transform: scale(0.95);
            box-shadow: 0 4px 20px rgba(139, 0, 255, 0.6);
        }

        .btn-icon {
            font-size: 2.5em;
            margin-bottom: 8px;
        }

        /* –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è */
        .quick-actions {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 12px;
            margin-bottom: 25px;
        }

        .quick-btn {
            background: linear-gradient(135deg, var(--surface), #2A2A4A);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 18px 8px;
            color: var(--text);
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
        }

        .quick-btn:hover {
            transform: translateY(-3px);
            border-color: var(--primary);
            box-shadow: 0 6px 20px rgba(139, 0, 255, 0.3);
        }

        .quick-btn:active {
            transform: translateY(-1px);
        }

        /* –ö–Ω–æ–ø–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è */
        .save-btn {
            background: linear-gradient(135deg, #32CD32, #228B22);
            border: none;
            border-radius: 12px;
            padding: 12px 20px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            margin: 10px 0;
            width: 100%;
            transition: all 0.3s ease;
        }

        .save-btn:active {
            transform: scale(0.98);
        }

        /* –ù–∏–∂–Ω—è—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(26, 26, 46, 0.95);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            padding: 12px 16px;
            gap: 8px;
        }

        .nav-btn {
            flex: 1;
            padding: 14px 8px;
            background: transparent;
            border: none;
            border-radius: 12px;
            color: var(--text-secondary);
            font-size: 1.3rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }

        .nav-btn.active {
            background: rgba(139, 0, 255, 0.15);
            color: var(--primary);
        }

        .nav-label {
            font-size: 0.7rem;
        }

        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .notification {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }

        .notification.active {
            display: flex;
        }

        .notification-content {
            background: linear-gradient(135deg, var(--surface), var(--background));
            border: 2px solid var(--primary);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            max-width: 320px;
            width: 100%;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }

        .notification-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .notification-title {
            color: var(--primary);
            font-size: 1.4rem;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .notification-text {
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .notification-close {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: none;
            color: white;
            padding: 14px 28px;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
        }

        .notification-close:active {
            transform: scale(0.98);
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 380px) {
            .main-action-btn {
                width: 180px;
                height: 180px;
                font-size: 1rem;
            }
            
            .size-display {
                font-size: 1.8rem;
            }
        }

        @media (max-height: 700px) {
            .game-container {
                padding: 15px 12px 70px;
            }
            
            .progress-section {
                padding: 20px 15px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- –®–∞–ø–∫–∞ -->
        <header class="game-header">
            <div class="game-title">üåå Quantum Evolution</div>
            <div class="user-welcome" id="user-welcome">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        </header>

        <!-- –†–µ—Å—É—Ä—Å—ã -->
        <div class="resources-grid">
            <div class="resource-card">
                <div class="resource-icon">‚ö°</div>
                <div class="resource-name">–≠–Ω–µ—Ä–≥–∏—è</div>
                <div class="resource-value" id="energy-value">1,000</div>
            </div>
            <div class="resource-card">
                <div class="resource-icon">üß†</div>
                <div class="resource-name">–ó–Ω–∞–Ω–∏—è</div>
                <div class="resource-value" id="knowledge-value">500</div>
            </div>
            <div class="resource-card">
                <div class="resource-icon">üíé</div>
                <div class="resource-name">–§—Ä–∞–≥–º–µ–Ω—Ç—ã</div>
                <div class="resource-value" id="fragments-value">0</div>
            </div>
        </div>

        <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å -->
        <section class="progress-section">
            <div class="size-display" id="current-size">1.6e-35 –º</div>
            <div class="stage-display" id="current-stage">–ü–ª–∞–Ω–∫–æ–≤—Å–∫–∞—è –¥–ª–∏–Ω–∞</div>
            <div class="era-display" id="current-era">–ö–≤–∞–Ω—Ç–æ–≤–∞—è —ç—Ä–∞ ‚Ä¢ 0.001%</div>
            
            <div class="progress-container">
                <div class="progress-fill" id="progress-bar"></div>
            </div>
        </section>

        <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞ -->
        <section class="action-section">
            <button class="main-action-btn" id="quantum-btn">
                <span class="btn-icon">‚öõÔ∏è</span>
                –ö–≤–∞–Ω—Ç–æ–≤–∞—è<br>—Ñ–ª—É–∫—Ç—É–∞—Ü–∏—è
            </button>
        </section>

        <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
        <section class="quick-actions">
            <button class="quick-btn" id="auto-btn">
                <span>ü§ñ</span>
                –ê–≤—Ç–æ-—Ä–æ—Å—Ç
            </button>
            <button class="quick-btn" id="research-btn">
                <span>üî¨</span>
                –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è
            </button>
            <button class="quick-btn" id="prestige-btn">
                <span>üí•</span>
                –ë–æ–ª—å—à–æ–π –≤–∑—Ä—ã–≤
            </button>
        </section>

        <!-- –ö–Ω–æ–ø–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è -->
        <button class="save-btn" id="save-btn">
            üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–≥—Ä—É
        </button>
    </div>

    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <nav class="bottom-nav">
        <button class="nav-btn active" data-tab="main">
            üåå
            <span class="nav-label">–ì–ª–∞–≤–Ω–∞—è</span>
        </button>
        <button class="nav-btn" data-tab="research">
            üî¨
            <span class="nav-label">–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è</span>
        </button>
        <button class="nav-btn" data-tab="progress">
            üìä
            <span class="nav-label">–ü—Ä–æ–≥—Ä–µ—Å—Å</span>
        </button>
        <button class="nav-btn" data-tab="library">
            üìö
            <span class="nav-label">–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞</span>
        </button>
    </nav>

    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ -->
    <div class="notification" id="notification">
        <div class="notification-content">
            <div class="notification-icon" id="notif-icon">üéâ</div>
            <div class="notification-title" id="notif-title">–ù–æ–≤—ã–π —ç—Ç–∞–ø!</div>
            <div class="notification-text" id="notif-text">–û–ø–∏—Å–∞–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</div>
            <button class="notification-close" id="notif-close">‚ú® –ü–æ–Ω—è—Ç–Ω–æ</button>
        </div>
    </div>

    <script>
        // === –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ò–ì–†–´ ===
        const stages = [
            // –ö–≤–∞–Ω—Ç–æ–≤–∞—è —ç—Ä–∞
            { 
                name: "–ü–ª–∞–Ω–∫–æ–≤—Å–∫–∞—è –¥–ª–∏–Ω–∞", 
                size: 1.6e-35, 
                era: "quantum", 
                fact: "–ù–∞–∏–º–µ–Ω—å—à–∞—è –≤–æ–∑–º–æ–∂–Ω–∞—è –¥–ª–∏–Ω–∞ –≤ —Ñ–∏–∑–∏–∫–µ - 1.6 √ó 10‚Åª¬≥‚Åµ –º–µ—Ç—Ä–æ–≤",
                color: "#8B00FF"
            },
            { 
                name: "–ö–≤–∞–Ω—Ç–æ–≤—ã–µ —Å—Ç—Ä—É–Ω—ã", 
                size: 1e-33, 
                era: "quantum", 
                fact: "–ì–∏–ø–æ—Ç–µ—Ç–∏—á–µ—Å–∫–∏–µ –æ–¥–Ω–æ–º–µ—Ä–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã –≤ —Ç–µ–æ—Ä–∏–∏ —Å—Ç—Ä—É–Ω",
                color: "#9D00FF"
            },
            { 
                name: "–í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ —á–∞—Å—Ç–∏—Ü—ã", 
                size: 1e-31, 
                era: "quantum", 
                fact: "–ß–∞—Å—Ç–∏—Ü—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –ø–æ—è–≤–ª—è—é—Ç—Å—è –∏ –∏—Å—á–µ–∑–∞—é—Ç –≤ –∫–≤–∞–Ω—Ç–æ–≤–æ–π –ø–µ–Ω–µ",
                color: "#AD00FF"
            },
            { 
                name: "–ö–≤–∞—Ä–∫", 
                size: 1e-18, 
                era: "quantum", 
                fact: "–§—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ —á–∞—Å—Ç–∏—Ü—ã, –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö —Å–æ—Å—Ç–æ—è—Ç –ø—Ä–æ—Ç–æ–Ω—ã –∏ –Ω–µ–π—Ç—Ä–æ–Ω—ã",
                color: "#BD00FF"
            },
            
            // –ê—Ç–æ–º–Ω–∞—è —ç—Ä–∞
            { 
                name: "–ê—Ç–æ–º –≤–æ–¥–æ—Ä–æ–¥–∞", 
                size: 1e-10, 
                era: "atomic", 
                fact: "–°–∞–º—ã–π —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –≤–æ –í—Å–µ–ª–µ–Ω–Ω–æ–π - 75% –±–∞—Ä–∏–æ–Ω–Ω–æ–π –º–∞—Å—Å—ã",
                color: "#00BFFF"
            },
            { 
                name: "–ê—Ç–æ–º —É–≥–ª–µ—Ä–æ–¥–∞", 
                size: 1.5e-10, 
                era: "atomic", 
                fact: "–û—Å–Ω–æ–≤–∞ –≤—Å–µ–π –æ—Ä–≥–∞–Ω–∏—á–µ—Å–∫–æ–π —Ö–∏–º–∏–∏ –∏ –∂–∏–∑–Ω–∏ –Ω–∞ –ó–µ–º–ª–µ",
                color: "#00C8FF"
            },
            
            // –ë–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è —ç—Ä–∞
            { 
                name: "–í–∏—Ä—É—Å", 
                size: 1e-7, 
                era: "biological", 
                fact: "–ù–µ —Å—á–∏—Ç–∞–µ—Ç—Å—è –∂–∏–≤—ã–º –æ—Ä–≥–∞–Ω–∏–∑–º–æ–º, –Ω–æ –º–æ–∂–µ—Ç —Ä–∞–∑–º–Ω–æ–∂–∞—Ç—å—Å—è –≤ –∫–ª–µ—Ç–∫–∞—Ö",
                color: "#32CD32"
            },
            { 
                name: "–ë–∞–∫—Ç–µ—Ä–∏—è", 
                size: 1e-6, 
                era: "biological", 
                fact: "–ü–µ—Ä–≤—ã–µ –∂–∏–≤—ã–µ –æ—Ä–≥–∞–Ω–∏–∑–º—ã –Ω–∞ –ó–µ–º–ª–µ, –ø–æ—è–≤–∏–ª–∏—Å—å 3.5 –º–ª—Ä–¥ –ª–µ—Ç –Ω–∞–∑–∞–¥",
                color: "#3CD43C"
            },
        ];

        const eras = {
            quantum: { name: "–ö–≤–∞–Ω—Ç–æ–≤–∞—è —ç—Ä–∞", color: "#8B00FF" },
            atomic: { name: "–ê—Ç–æ–º–Ω–∞—è —ç—Ä–∞", color: "#00BFFF" },
            biological: { name: "–ë–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è —ç—Ä–∞", color: "#32CD32" }
        };

        // === –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ò–ì–†–´ ===
        let gameState = {
            size: 1.6e-35,
            currentStage: 0,
            energy: 1000,
            knowledge: 500,
            quantumFragments: 0,
            autoGrowth: 0,
            growthMultiplier: 1,
            totalClicks: 0,
            totalBigBangs: 0,
            lastSave: Date.now()
        };

        let tg = window.Telegram?.WebApp;

        // === –£–õ–£–ß–®–ï–ù–ù–ê–Ø –°–ò–°–¢–ï–ú–ê –°–û–•–†–ê–ù–ï–ù–ò–Ø ===
        function initGame() {
            console.log("üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã...");
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram
            if (tg) {
                tg.expand();
                tg.enableClosingConfirmation();
                const user = tg.initDataUnsafe?.user;
                if (user) {
                    document.getElementById('user-welcome').textContent = `üëã –ü—Ä–∏–≤–µ—Ç, ${user.first_name || '–ò–≥—Ä–æ–∫'}!`;
                }
            }

            loadGame();
            setupEventListeners();
            startGameLoop();
            updateDisplay();
            
            console.log("‚úÖ –ò–≥—Ä–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω–∞!");
        }

        function loadGame() {
            try {
                // –ü—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ localStorage –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å
                const saved = localStorage.getItem('quantum_evolution');
                if (saved) {
                    const loaded = JSON.parse(saved);
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤–∞–ª–∏–¥–Ω—ã
                    if (loaded && typeof loaded.size === 'number') {
                        Object.assign(gameState, loaded);
                        console.log("üíæ –ò–≥—Ä–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∏–∑ localStorage");
                        showNotification("üíæ", "–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ", "–í–∞—à –ø—Ä–æ–≥—Ä–µ—Å—Å —É—Å–ø–µ—à–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!");
                        return;
                    }
                }
                
                // –ï—Å–ª–∏ –≤ localStorage –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö, –ø—Ä–æ–±—É–µ–º Telegram Cloud Storage
                if (tg && tg.CloudStorage && tg.CloudStorage.getItem) {
                    tg.CloudStorage.getItem('quantum_evolution', (err, data) => {
                        if (!err && data) {
                            try {
                                const loaded = JSON.parse(data);
                                if (loaded && typeof loaded.size === 'number') {
                                    Object.assign(gameState, loaded);
                                    console.log("üíæ –ò–≥—Ä–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∏–∑ Telegram Cloud");
                                    showNotification("üíæ", "–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ", "–í–∞—à –ø—Ä–æ–≥—Ä–µ—Å—Å —É—Å–ø–µ—à–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏–∑ –æ–±–ª–∞–∫–∞!");
                                }
                            } catch (e) {
                                console.log("‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ Cloud Storage:", e);
                            }
                        }
                    });
                }
            } catch (e) {
                console.log("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:", e);
            }
        }

        function saveGame(showNotification = false) {
            try {
                gameState.lastSave = Date.now();
                const saveData = JSON.stringify(gameState);
                
                console.log("üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–≥—Ä—ã:", gameState);
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage (–æ—Å–Ω–æ–≤–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ)
                localStorage.setItem('quantum_evolution', saveData);
                
                // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Telegram Cloud Storage –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ
                if (tg && tg.CloudStorage && tg.CloudStorage.setItem) {
                    tg.CloudStorage.setItem('quantum_evolution', saveData, (err) => {
                        if (!err) {
                            console.log("üíæ –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Cloud Storage —É—Å–ø–µ—à–Ω–æ");
                        }
                    });
                }
                
                if (showNotification) {
                    showNotification("üíæ", "–ò–≥—Ä–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞", "–í–∞—à –ø—Ä–æ–≥—Ä–µ—Å—Å —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω!");
                }
                
                return true;
            } catch (e) {
                console.log("‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:", e);
                showNotification("‚ùå", "–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è", "–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–≥—Ä—É. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.");
                return false;
            }
        }

        function forceSave() {
            const success = saveGame(true);
            if (success) {
                // –ê–Ω–∏–º–∞—Ü–∏—è –∫–Ω–æ–ø–∫–∏
                const btn = document.getElementById('save-btn');
                btn.style.background = 'linear-gradient(135deg, #32CD32, #228B22)';
                setTimeout(() => {
                    btn.style.background = 'linear-gradient(135deg, #32CD32, #228B22)';
                }, 200);
            }
        }

        function setupEventListeners() {
            // –û—Å–Ω–æ–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞
            document.getElementById('quantum-btn').addEventListener('click', handleQuantumClick);
            document.getElementById('quantum-btn').addEventListener('touchstart', function(e) {
                e.preventDefault();
                handleQuantumClick();
            });

            // –ë—ã—Å—Ç—Ä—ã–µ –∫–Ω–æ–ø–∫–∏
            document.getElementById('auto-btn').addEventListener('click', function() {
                buyAutoGrowth();
            });

            document.getElementById('research-btn').addEventListener('click', function() {
                showResearchTab();
            });

            document.getElementById('prestige-btn').addEventListener('click', function() {
                showPrestigeInfo();
            });

            // –ö–Ω–æ–ø–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
            document.getElementById('save-btn').addEventListener('click', forceSave);

            // –ù–∞–≤–∏–≥–∞—Ü–∏—è
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    switchTab(this.dataset.tab);
                });
            });

            // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            document.getElementById('notif-close').addEventListener('click', closeNotification);

            // –ê–≤—Ç–æ-—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
            window.addEventListener('beforeunload', function() {
                saveGame();
            });

            // –ê–≤—Ç–æ-—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            document.addEventListener('visibilitychange', function() {
                if (document.hidden) {
                    saveGame();
                }
            });
        }

        function handleQuantumClick() {
            const baseGrowth = 1.6e-37;
            gameState.size += baseGrowth * gameState.growthMultiplier;
            gameState.energy += 10;
            gameState.knowledge += 5;
            gameState.totalClicks++;
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –∫–Ω–æ–ø–∫–∏
            const btn = document.getElementById('quantum-btn');
            btn.style.transform = 'scale(0.95)';
            setTimeout(() => {
                btn.style.transform = 'scale(1)';
            }, 150);
            
            checkStageProgression();
            updateDisplay();
            
            // –ê–≤—Ç–æ-—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∫–ª–∏–∫–∞
            if (gameState.totalClicks % 10 === 0) {
                saveGame();
            }
            
            console.log("‚öõÔ∏è –ö–ª–∏–∫! –†–∞–∑–º–µ—Ä:", gameState.size);
        }

        function buyAutoGrowth() {
            if (gameState.energy >= 1000) {
                gameState.energy -= 1000;
                gameState.autoGrowth += 1e-38;
                showNotification("ü§ñ", "–ê–≤—Ç–æ-—Ä–æ—Å—Ç –∫—É–ø–ª–µ–Ω!", "+1e-38 –º/—Å–µ–∫ –∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–º—É —Ä–æ—Å—Ç—É");
                updateDisplay();
                saveGame();
            } else {
                showNotification("‚ùå", "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —ç–Ω–µ—Ä–≥–∏–∏", "–ù—É–∂–Ω–æ 1000 —ç–Ω–µ—Ä–≥–∏–∏ –¥–ª—è –ø–æ–∫—É–ø–∫–∏ –∞–≤—Ç–æ-—Ä–æ—Å—Ç–∞");
            }
        }

        function showResearchTab() {
            showNotification("üî¨", "–°–∏—Å—Ç–µ–º–∞ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π", "–°–∫–æ—Ä–æ –∑–¥–µ—Å—å –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –Ω–æ–≤—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –∏ —É—Å–∫–æ—Ä–∏—Ç–µ–ª–∏!");
        }

        function showPrestigeInfo() {
            showNotification("üí•", "–ë–æ–ª—å—à–æ–π –≤–∑—Ä—ã–≤", "–î–æ—Å—Ç–∏–≥–Ω–∏—Ç–µ —Ä–∞–∑–º–µ—Ä–∞ –í—Å–µ–ª–µ–Ω–Ω–æ–π —á—Ç–æ–±—ã –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ë–æ–ª—å—à–æ–π –í–∑—Ä—ã–≤ –∏ –Ω–∞—á–∞—Ç—å –Ω–æ–≤—ã–π —Ü–∏–∫–ª —Å –±–æ–Ω—É—Å–∞–º–∏!");
        }

        function switchTab(tabName) {
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            
            if (tabName !== 'main') {
                showNotification("üîß", "–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ", `–í–∫–ª–∞–¥–∫–∞ "${tabName}" —Å–∫–æ—Ä–æ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞!`);
            }
        }

        function checkStageProgression() {
            const currentStageIndex = gameState.currentStage;
            const nextStage = stages[currentStageIndex + 1];
            
            if (nextStage && gameState.size >= nextStage.size) {
                gameState.currentStage++;
                showStageNotification(stages[gameState.currentStage]);
                saveGame(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–∏ —Å–º–µ–Ω–µ —ç—Ç–∞–ø–∞
            }
        }

        function showStageNotification(stage) {
            showNotification("üéâ", `–ù–æ–≤—ã–π —ç—Ç–∞–ø: ${stage.name}`, stage.fact);
        }

        function showNotification(icon, title, text) {
            document.getElementById('notif-icon').textContent = icon;
            document.getElementById('notif-title').textContent = title;
            document.getElementById('notif-text').textContent = text;
            document.getElementById('notification').classList.add('active');
        }

        function closeNotification() {
            document.getElementById('notification').classList.remove('active');
        }

        function startGameLoop() {
            setInterval(() => {
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–æ—Å—Ç
                if (gameState.autoGrowth > 0) {
                    gameState.size += gameState.autoGrowth * gameState.growthMultiplier;
                    checkStageProgression();
                    updateDisplay();
                }

                // –ê–≤—Ç–æ-—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
                if (Date.now() - gameState.lastSave > 30000) {
                    saveGame();
                }
            }, 1000);
        }

        function updateDisplay() {
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–∞–∑–º–µ—Ä
            document.getElementById('current-size').textContent = formatSize(gameState.size);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —ç—Ç–∞–ø –∏ —ç—Ä—É
            const currentStage = stages[gameState.currentStage];
            document.getElementById('current-stage').textContent = currentStage.name;
            
            const nextStage = stages[gameState.currentStage + 1];
            const progressPercent = nextStage 
                ? Math.min(100, ((gameState.size - currentStage.size) / (nextStage.size - currentStage.size)) * 100)
                : 100;
                
            document.getElementById('current-era').textContent = 
                `${eras[currentStage.era].name} ‚Ä¢ ${progressPercent.toFixed(3)}%`;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
            document.getElementById('progress-bar').style.width = `${progressPercent}%`;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ—Å—É—Ä—Å—ã
            document.getElementById('energy-value').textContent = formatNumber(gameState.energy);
            document.getElementById('knowledge-value').textContent = formatNumber(gameState.knowledge);
            document.getElementById('fragments-value').textContent = formatNumber(gameState.quantumFragments);
        }

        function formatSize(size) {
            if (size < 1e-9) return size.toExponential(2) + ' –º';
            if (size < 1e-6) return (size * 1e9).toFixed(2) + ' –Ω–º';
            if (size < 1e-3) return (size * 1e6).toFixed(2) + ' –º–∫–º';
            if (size < 1) return (size * 1000).toFixed(2) + ' –º–º';
            if (size < 1000) return size.toFixed(2) + ' –º';
            return (size / 1000).toFixed(2) + ' –∫–º';
        }

        function formatNumber(num) {
            if (num < 1000) return Math.floor(num).toString();
            if (num < 1e6) return (num / 1000).toFixed(1) + 'K';
            if (num < 1e9) return (num / 1e6).toFixed(1) + 'M';
            return (num / 1e9).toFixed(1) + 'B';
        }

        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
        document.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>